<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="./output.css" rel="stylesheet" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Borel&family=Pacifico&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/d879469828.js" crossorigin="anonymous"></script>
    <title id="page-title"></title>
    <link rel="icon" type="image/x-icon" href="images/fav.ico" />
</head>

<body data-day-offset="1" class="bg-neutral w-[85%] mx-auto">
    <section>
        <img src="images/garland.png" alt="Morning Image" class="object-fill pt-10 m-auto" />
        <div class="flex flex-col items-center">
            <h1 class="text-9xl text-nowrap font-main text-main underline py-4 text-shadow-lg text-shadow-black/20">
                Sign in!
            </h1>
            <button type="button" id="google-signin"
                class="mt-15 bg-white  text-main px-24 py-6 rounded-full shadow-inner shadow-inner-xl shadow-black/40 hover:bg-main hover:text-white">
                <i class="fa-brands fa-google text-4xl"></i>
            </button>
        </div>
    </section>
    <!-- Firebase boot + bridge -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, onSnapshot, collection } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDW5xBcbpHzWrFpO8LDA4vVt8qeenGqosw",
            authDomain: "planner-bdd6f.firebaseapp.com",
            projectId: "planner-bdd6f",
            storageBucket: "planner-bdd6f.firebasestorage.app",
            messagingSenderId: "575920639228",
            appId: "1:575920639228:web:10b3f9250d861086639b79"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        window.firebaseServices = {
            auth, db,
            GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut,
            doc, setDoc, getDoc, onSnapshot, collection
        };

        // tiny auth UI
        const bar = Object.assign(document.createElement('div'), { style: 'position:fixed;top:8px;right:8px;z-index:9999' });
        const signIn = Object.assign(document.createElement('button'), { textContent: 'Sign in' });
        const signOutBtn = Object.assign(document.createElement('button'), { textContent: 'Sign out', style: 'margin-left:6px;display:none' });
        bar.append(signIn, signOutBtn); document.body.append(bar);
        signIn.onclick = () => signInWithPopup(auth, new GoogleAuthProvider());
        signOutBtn.onclick = () => signOut(auth);
        document.getElementById('google-signin')
            ?.addEventListener('click', () =>
                signInWithPopup(auth, new GoogleAuthProvider()));

        // route + sync
        onAuthStateChanged(auth, u => {
            signIn.style.display = u ? 'none' : '';
            signOutBtn.style.display = u ? '' : 'none';

            const here = (location.pathname.split('/').pop() || 'index.html').toLowerCase();
            const onLanding = here === 'index.html';

            if (u && onLanding) location.replace('./today.html');
            if (!u && !onLanding) location.replace('./index.html');

            if (u && window.startFirebaseSync) window.startFirebaseSync(u);
        });
    </script>
    <script src="main.js" defer></script>
</body>

</html>